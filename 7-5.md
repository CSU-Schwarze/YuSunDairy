### 7.5
#### SSRF漏洞--服务器端请求伪造
```
SSRF是大型站点中出现频率较高的漏洞

大都是由于服务器提供了从其他服务器获取数据的功能，且没有对目标地址做过滤与限制，如从指定URL地址加载图片等资源或获取指定页面的内容

攻击者伪造请求，通过A间接访问内网中B的资源，用户不能直接访问B，但通过A获取了B的资源

SSRF攻击的PHP相关危险函数包含file_get_contents()、fsockopen()、curl_exec()，主要是网络访问，支持伪协议的网络读取

相关协议有Dict协议（用于内网的端口探测，使用端口2628）、HTTP协议（发送HTTP请求获取资源）、File协议（在内网中常见，用于访问本地计算机中的文件，也可以用于访问其他Windows的文件）、Gopher协议（分布式文件搜索获取）

Java无法使用Dict协议

curl命令可以模拟HTTP请求，会返回响应的页面或资源，例如curl -v 'file://127.0.0.1/etc/passwd'，-v可以显示更完整的信息（响应头等）；curl 'dict://127.0.0.1:22'，若端口开放，会返回使用该端口的服务版本

SSRF漏洞比较容易挖掘，因为有明显的参数要向某个服务器获取数据，比如file、filename、url

SSRF的危害是攻击内网，也可以获取内网中服务器的数据，读取内网中服务器的文件，也可以对内网中服务器进行端口扫描，例如如果用dict或http协议扫描到存在Redis数据库，它默认安装没有密码，存在未授权漏洞，可以利用SSRF的http协议进行对内网的Redis攻击

以台湾实验教育推动中心管理后台为例，通过在本地伪造IP为127.0.0.1，可以直接进入管理员后台

以盘古ERP为例，存在用户名枚举漏洞，可以利用Burpsuite得到存在的用户名列表，并对用户的密码进行爆破，得到admin用户的密码qq123123，登录后发现存在SSRF漏洞，将获取php文件的url改为file或dict协议，然后利用linux常见路径进行爆破，得到服务器的信息
```
#### XSS漏洞--跨站脚本攻击
```
不对用户的输入作处理直接返回到前端，用户可以输入script等，使得脚本在客户端被执行

XSS危害：盗取Cookie（最常用，使用document.cookie）、网络钓鱼

XSS分为反射型、存储型、DOM型

反射型不是持久性的，是参数型的跨站脚本，恶意代码没有保存在目标网站，通过引诱用户点击一个链接到目标网站的恶意链接实现攻击，反弹一次就没了

存储型是持久性的，一般这类站点都有后台系统，恶意代码被保存到目标网站的服务器中，当用户在前台访问带有脚本的文件时就会调用脚本；比较常见的场景是攻击者将一段JavaScript脚本写入博客中上传到后台，当用户查看这篇博客时，内置的js脚本会将用户信息弹到攻击者

DOM型的常见语法document.write()

DOM型只能输出在动态构造的DOM节点中，另两种是在HTTP响应中

XSS常见的弹窗函数有alert、confirm、prompt，如果都被禁用了就没有办法弹窗了
```
#### 如何进行漏洞挖掘/渗透测试
```
1.进行信息收集：IP、端口（TScanPlus、Yakit）、服务器OS、中间件、脚本语言、开发框架（Java重点）、指纹、目录扫描（优先寻找后台地址（/admin、/login），寻找后台登录页面，寻找配置信息）

2.后台系统弱口令测试，查看js文件中是否有敏感信息（Jsfinder）

3.常规的一些漏洞测试，自动化测试（用一些工具扫描：Xray、ez--逻辑漏洞和文件上传漏洞无法测试，要添加反连平台针对Fastjson、log4j、strurs2；自定义字典进行测试）

4.清理测试痕迹，可以保留一些后门

5.输出报告
```
